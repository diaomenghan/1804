
案例练习,准备:
            rht-vmctl  reset  classroom
            rht-vmctl  reset  server
	    rht-vmctl  reset  desktop
########################################################################

?案例1:为虚拟机 server0 配置以下静态地址参数
C 主机名:server0.example.com
C IP地址:172.25.0.11
C 子网掩码:255.255.255.0
C 默认网关:172.25.0.254
C DNS服务器:172.25.254.254
[root@server0 ~]# echo server0.example.com > /etc/hostname
[root@server0 ~]# nmcli connection show 
[root@server0 ~]# nmcli connection modify 'System eth0' ipv4.method manual ipv4.addresses '172.25.0.11/24 172.25.0.254' connection.autoconnect yes
[root@server0 ~]# nmcli connection up 'System eth0' 
Connection successfully activated (D-Bus active path: /org/freedesktop/NetworkManager/ActiveConnection/1)
[root@server0 ~]# echo nameserver 172.25.254.254 > /etc/resolv.conf 


案例2:为虚拟机 desktop0 配置以下静态地址参数
C 主机名:desktop0.example.com
C IP地址:172.25.0.10
C 子网掩码:255.255.255.0
C 默认网关:172.25.0.254
C DNS服务器:172.25.254.254
[root@desktop0 ~]# echo desktop0.example.com > /etc/hostname
[root@desktop0 ~]# nmcli connection show 
[root@desktop0 ~]# nmcli connection modify 'System eth0' ipv4.method manual ipv4.addresses '172.25.0.10/24 172.25.0.254' connection.autoconnect yes
[root@desktop0 ~]# nmcli connection up 'System eth0' 
Connection successfully activated (D-Bus active path: /org/freedesktop/NetworkManager/ActiveConnection/1)
[root@desktop0 ~]# echo nameserver 172.25.254.254 > /etc/resolv.conf 
[root@desktop0 ~]# nslookup desktop0.example.com


案例3:指定yum软件源
为 server0 指定可用的 yum 软件源
C YUM软件库的地址为 http://classroom.example.com/content/rhel7.0/x86_64/dvd
C 将此配置为虚拟机 server0 的默认软件仓库
C 确认可用的仓库列表
C 利用yum仓库安装httpd与vsftpd
[root@server0 ~]# rm -rf /etc/yum.repos.d/*
[root@server0 ~]# vim /etc/yum.repos.d/dvd.repo
[root@server0 ~]# cat /etc/yum.repos.d/dvd.repo 
[dvd]
name=dvd
baseurl=http://classroom.example.com/content/rhel7.0/x86_64/dvd
enabled=1
gpgcheck=0
[root@server0 ~]# yum repolist 
[root@server0 ~]# yum -y install httpd
[root@server0 ~]# yum -y install vsftpd

案例4:指定yum软件源
为 desktop0 指定可用的 yum 软件源
C YUM软件库的地址为 http://classroom.example.com/content/rhel7.0/x86_64/dvd
C 将此配置为虚拟机 server0 的默认软件仓库
C 确认可用的仓库列表
C 利用yum仓库安装httpd与vsftpd
[root@desktop0 ~]# rm -rf /etc/yum.repos.d/*
[root@desktop0 ~]# vim /etc/yum.repos.d/dvd.repo
[root@desktop0 ~]# cat /etc/yum.repos.d/dvd.repo 
[dvd]
name=dvd
baseurl=http://classroom.example.com/content/rhel7.0/x86_64/dvd
enabled=1
gpgcheck=0
[root@desktop0 ~]# yum repolist 
[root@desktop0 ~]# yum -y install httpd
[root@desktop0 ~]# yum -y install vsftpd


案例5：虚拟机 server0上操作，复制、粘贴、移动
 以root用户新建/nsddir/目录，在此目录下新建readme.txt文件，并进一步完成下列操作

 1）将“I love Linux”写入到文件readme.txt 
 2）将readme.txt重命名为mylove.txt
 3）将/etc/passwd、/boot、/etc/group同时拷贝到/nsddir目录下
 4）将ifconfig命令的前两行内容，追加写入mylove.txt
 5）创建/etc/hostname文件
 6）将主机名永久配置文件，拷贝到/nsddir目录下
 7）将DNS永久配置文件，拷贝到/nsddir目录下
[root@server0 ~]# mkdir /nsddir
[root@server0 ~]# touch /nsddir/readme.txt
[root@server0 ~]# echo I love Linux > /nsddir/readme.txt
[root@server0 ~]# mv /nsddir/readme.txt /nsddir/mylove.txt
[root@server0 ~]# cp -r /etc/passwd /boot/ /etc/group /nsddir/
[root@server0 ~]# ls /nsddir/
boot  group  mylove.txt  passwd
[root@server0 ~]# ifconfig | head -2 >> /nsddir/mylove.txt 
[root@server0 ~]# mkdir /etc/hostname
[root@server0 ~]# cp /etc/hostname /nsddir/
[root@server0 ~]# cp /etc/resolv.conf /nsddir/



案例6：虚拟机Server上操作：复制、删除、移动及vim文本编辑器
  1. 新建目录结构/nsd/test
  2. 在目录/nsd/test创建文件nsd.txt并写入内容 NSD  Student
  3. 将/nsd/test/nsd.txt文件复制到/root目录下，同时 改名为 tedu.txt
  4. 利用vim 修改文件/etc/hostname将其原有内容全部删除，写入新的内容为server0.example.com
  5. 将/etc/passwd 、/etc/resolv.conf、/etc/hostname 同时拷贝到/nsd/test/目录下
  6. 将文件 /nsd/test/hostname 重改名为 hn.txt 
  7. 创建目录结构/nsd/test/kernel
  7. 将目录 /boot内容中以 vm 开头的 复制到/nsd/test/kernel目录下 
[root@server0 ~]# mkdir -p /nsd/test
[root@server0 ~]# echo NSD Student > /nsd/test/nsd.txt
[root@server0 ~]# vim /etc/host
host.conf    hostname     hosts        hosts.allow  hosts.deny   
[root@server0 ~]# vim /etc/hostname 
[root@server0 ~]# cp /etc/passwd /etc/resolv.conf /etc/hostname /nsd/test/
[root@server0 ~]# ls /nsd/test/
hostname  nsd.txt  passwd  resolv.conf
[root@server0 ~]# mv /nsd/test/hostname /nsd/test/hn.txt
[root@server0 ~]# mkdir /nsd/test/kernel
[root@server0 ~]# cp -r /boot/vm* /nsd/test/kernel
[root@server0 ~]# ls /nsd/test/kernel



案例6:虚拟机 server0上操作，查找并处理文件
C 利用find查找所有用户 student 拥有的文件,把它们拷贝到 /root/findfiles/ 文件夹中
C 利用find查找/boot目录下大于10M并且必须是文件，拷贝到/opt
C 利用find查找/boot/ 目录下以 vm 开头且必须是文件，拷贝到/opt
C 利用find查找/etc 目录下，以 tab 作为结尾的 必须是文件
[root@server0 ~]# mkdir /root/findfiles
[root@server0 ~]# find / -user student -type f -exec cp -p {} /root/findfiles \;
[root@server0 ~]# find /boot/ -size +10M -type f -exec cp {} /opt \;
[root@server0 ~]# find /boot/ -name "vm*" -type f -exec cp {} /opt/ \;
[root@server0 ~]# ls /opt/
[root@server0 ~]# find /etc/ -name "*tab" -type f


案例7:虚拟机 server0上操作,查找并提取文件内容
1.在文件 /usr/share/dict/words 中查找到所有包含字符串 seismic 的行,将输出信息,写入到/opt/nsd.txt
2.将/etc/login.defs文件以“#”开头的内容 写入到/root/login.txt
3.提取/etc/passwd以root开头的行，将其信息写入/opt/admin.txt
[root@server0 ~]# grep 'seismic' /usr/share/dict/words > /opt/nsd.txt
[root@server0 ~]# grep '^#' /etc/login.defs > /root/login.txt
[root@server0 ~]# cat /root/login.txt
[root@server0 ~]# grep '^root' /etc/passwd > /opt/admin.txt
[root@server0 ~]# cat /opt/admin.txt


案例8:虚拟机 server0上操作,tar制作/释放归档压缩包（zcf、ztf、zxf、jcf、jtf、jxf、cf、tf）
    1）备份/boot、/home这两个文件夹，保存为boothome.tar.gz文件
    2）查看boothome.tar.gz文件内包含哪些内容 
    3）将boothome.tar.gz释放到文件夹/root/boothome/下
    4）创建一个名为 /root/backup.tar.bz2 的归档文件，其中包含 /usr/local 目录中的内容
[root@server0 ~]# tar -zcPf boothome.tar.gz /boot/ /home/
[root@server0 ~]# tar -tf boothome.tar.gz 
[root@server0 ~]# mkdir /root/boothome/
[root@server0 ~]# tar -xf boothome.tar.gz -C /root/boothome/
[root@server0 ~]# tar -jcPf /root/backup.tar.bz2 /usr/local/


案例9:虚拟机 server0上操作
	 新建用户 alex，其用户ID为3456，密码是flectrag 
	 创建下列用户、组以及组的成员关系： 
	 C 一个名为 adminuser 的组 
	 C 一个名为 natasha 的用户，其属于 adminuser 组， 这个组是该用户的从属组 
	 C 一个名为 harry 的用户，其属于 adminuser 组，这个 组是该用户的从属组 
	 C 一个名为 sarah 的用户，其在系统中没有可交互的 Shell（/sbin/nologin），并且不是 adminuser 组的成员 
	 C natasha 、harry、sarah 的密码都要设置为 flectra
	 C 创建zhangsan用户
 	 C 创建lisi用户
	 C 创建tarena组
[root@server0 ~]# groupadd adminuser
[root@server0 ~]# useradd -G adminuser natasha
[root@server0 ~]# useradd -s /sbin/nologin sarah
[root@server0 ~]# echo flectrag | passwd --stdin natasha
[root@server0 ~]# echo flectrag | passwd --stdin harry
[root@server0 ~]# echo flectrag | passwd --stdin sarah
[root@server0 ~]# useradd zhangsan
[root@server0 ~]# useradd lisi
[root@server0 ~]# groupadd tarena

案例10:虚拟机 server0上操作
    为用户 natasha 配置一个定时任务 
	C 每天在本地时间 14:23 执行 
	C 需要完成的任务操作为 /bin/echo  hiya
[root@server0 ~]# crontab -e -u natasha
23 14 * * * /bin/echo  hiya
[root@server0 ~]# systemctl restart crond
[root@server0 ~]# systemctl enable crond



案例11：chown归属设置
    1）新建/tarena1目录
	a）将属主设为gelin01，属组设为tarena组
	b）使用户gelin01对此目录具有rwx权限，其他人对此目录无任何权限

    2）使用户gelin02能进入、查看/tarena1文件夹（提示：将gelin02加入所属组）

    3）新建/tarena2目录
	a）将属组设为tarena
	b）使tarena组的任何用户都能在此目录下创建、删除文件

    4）新建/tarena/public目录
	a）使任何用户对此目录都有rwx权限
	b）拒绝zhangsan进入此目录，对此目录无任何权限
[root@server0 ~]# mkdir /tarena1
[root@server0 ~]# ls -ld /tarena1
[root@server0 ~]# useradd gelin01
[root@server0 ~]# chown gelin01:tarena /tarena1
[root@server0 ~]# chmod o=--- /tarena1
[root@server0 ~]# useradd gelin02
[root@server0 ~]# gpasswd -a gelin02 tarena
[root@server0 ~]# mkdir /tarena2
[root@server0 ~]# chown :tarena /tarena2
[root@server0 ~]# chmod g+w /tarena2
[root@server0 ~]# mkdir -p /tarena/public
[root@server0 ~]# ls -ld /tarena/public/
[root@server0 ~]# chmod ugo=rwx /tarena/public/
[root@server0 ~]# setfacl -m u:zhangsan:--- /tarena/public/


案例12:权限设置
	1、创建文件夹/data/test,设置目录的访问权限，使所有者和所属组具备读写执行的权限；其他人无任何权限。
	2、递归修改文件夹/data/test的归属使所有者为zhangsan，所属组为tarena。
	3、请实现在test目录下，新建的所有子文件或目录的所属组都会是tarena。
	4、为lisi创建ACL访问权限，使得lisi可以查看/etc/shadow文件
[root@server0 ~]# mkdir -p /data/test
[root@server0 ~]# ls -ld /data/test
drwxr-xr-x. 2 root root 6 3月  22 10:09 /data/test
[root@server0 ~]# chmod ug=rwx,o=--- /data/test
[root@server0 ~]# chown -R zhangsan:tarena /data/test
[root@server0 ~]# ls -ld /data/test
drwxrwx---. 2 zhangsan tarena 6 3月  22 10:09 /data/test
[root@server0 ~]# chmod g+s /data/test
[root@server0 ~]# ls -ld /data/test
drwxrws---. 2 zhangsan tarena 6 3月  22 10:09 /data/test
[root@server0 ~]# setfacl -m u:lisi:r /etc/shadow



案例13：虚拟机 server0上操作,绑定到LDAP验证服务

 C  使用系统 classroom.example.com 提供的LDAP服务
 C  验证服务的基本DN是：dc=example,dc=com
 C  账户信息和验证信息都是由 LDAP 提供的
 C  连接要使用证书加密，证书可以在下面的链接下载：
      http://classroom.example.com/pub/example-ca.crt 
 C  确认本地可以识别ldapuser10用户
[root@server0 ~]# yum -y install sssd
[root@server0 ~]# yum -y install authconfig-gtk.x86_64 
[root@server0 ~]# authconfig-gtk 
设置为ldap DN是：dc=example,dc=com 服务器classroom.example.com
tls加密http://classroom.example.com/pub/example-ca.crt 
认证方法为ldap密码
[root@server0 ~]# systemctl restart sssd
[root@server0 ~]# systemctl enable sssd
[root@server0 ~]# id ldapuser10
uid=1710(ldapuser10) gid=1710(ldapuser10) 组=1710(ldapuser10)


案例14：虚拟机 server0上操作,访问NFS共享
 C  查看classroom.example.com的NFS共享
 C  将classroom.example.com的NFS共享目录，挂载到本地/home/guests
[root@server0 ~]# showmount -e classroom.example.com
[root@server0 ~]# mkdir /home/guests
[root@server0 ~]# mount classroom.example.com:/home/guests/ /home/guests
[root@server0 ~]# su - ldapuser10


案例15:虚拟机 server0上操作,（MBR分区模式）规划分区
 添加一块70G的硬盘并规划分区：
   划分2个10G的主分区；
   1个12G的主分区
   2个10G的逻辑分区。
[root@server0 ~]# lsblk 
[root@server0 ~]# fdisk /dev/vdc
n->enter->enter->+10G->n->enter->enter->+10G->n->enter->enter->+12G->n->enter->enter->enter->n->enter->+10G->n->enter->+10G->p->w
[root@server0 ~]# partprobe 



案例16:在server上操作,分区使用

1、案例15中新添加70G硬盘的第二个逻辑分区
C 格式化成xfs分区，实现该分区开机自动挂载/mnt/xpart
[root@server0 ~]# mkfs.xfs /dev/vdc6
[root@server0 ~]# mkdir /mnt/xpart
[root@server0 ~]# vim /etc/fstab 
[root@server0 ~]# tail -1 /etc/fstab 
/dev/vdc6 /mnt/xpart xfs defaults 0 0 
[root@server0 ~]# mount -a

2、案例15中新添加70G硬盘的第一个逻辑分区
C 完成开机自动挂载，挂载点/mnt/mypart,文件系统为ext4
[root@server0 ~]# mkfs.ext4 /dev/vdc5
[root@server0 ~]# mkdir /mnt/mypart
[root@server0 ~]# vim /etc/fstab 
[root@server0 ~]# tail -1 /etc/fstab
/dev/vdc5 /mnt/mypart ext4 defaults 0 0
[root@server0 ~]# mount -a


案例17:虚拟机 server0操作，构建 LVM 存储

 C 新建一个名为 systemvg 的卷组 
 C 在此卷组中创建一个名为 vo 的逻辑卷，大小为8G 
 C 将逻辑卷 vo 格式化为 xfs 文件系统 
 C 将逻辑卷 vo 挂载到 /vo 目录，并在此目录下建立一个测试文件 votest.txt，内容为“I AM KING.” 
 C 实现逻辑卷vo开机自动挂载到/vo
[root@server0 ~]# lsblk 
[root@server0 ~]# vgcreate systemvg /dev/vdc1
[root@server0 ~]# lvcreate -L 8G -n vo systemvg 
[root@server0 ~]# mkfs.xfs /dev/systemvg/vo 
[root@server0 ~]# mkdir /vo
[root@server0 ~]# mount /dev/systemvg/vo /vo
[root@server0 ~]# echo I AM KING > /vo/votest.txt
[root@server0 ~]# cat /vo/votest.txt
I AM KING
[root@server0 ~]# vim /etc/fstab 
[root@server0 ~]# tail -1 /etc/fstab
/dev/systemvg/vo /vo xfs defaults 0 0 
[root@server0 ~]# mount -a



案例18:虚拟机 server0操作，构建 LVM 存储(修改PE大小)
 C 在 datastore 卷组中的所有逻辑卷，其PE的大小为1M
 C 新的逻辑卷命名为 database，其大小为50个PE的大小，属于 datastore 卷组 
 C 使用 EXT3 文件系统对逻辑卷 database 格式化，此逻辑卷应该在开机时自动挂载到 /mnt/database 目录
[root@server0 ~]# vgcreate datastore /dev/vdc2
[root@server0 ~]# vgchange -s 1M datastore 
[root@server0 ~]# lvcreate -n database -l 50 /dev/datastore
[root@server0 ~]# mkfs.ext3 /dev/datastore/database 
[root@server0 ~]# lsblk 
[root@server0 ~]# mkdir /mnt/database
[root@server0 ~]# vim /etc/fstab 
[root@server0 ~]# tail -1 /etc/fstab
/dev/datastore/database /mnt/database ext3 defaults 0 0 
[root@server0 ~]# mount -a

 
案例19:在在 server0、desktop0 上操作
C 将防火墙默认区域设置为trusted
[root@server0 ~]# firewall-cmd --set-default-zone=trusted 
success
[root@desktop0 ~]# firewall-cmd --set-default-zone=trusted 
success




案例21:在server上操作，搭建mariadb数据库系统
 1. 在 server0 上安装 MariaDB 数据库系统
   1)安装 mariadb-server软件包
   2)启动 mariadb 服务
[root@server0 ~]# yum -y install mariadb-server.x86_64 
[root@server0 ~]# systemctl restart mariadb.service 

案例22：配置聚合连接
在两个虚拟机之间配置一个链路，要求如下： 
	C 此链路使用接口 eth1 和 eth2 
	C 此链路在其中一个接口失效时仍然能工作 
	C 此链路在 server0 上使用下面的地址 172.16.3.20/255.255.255.0 
	C 此链路在 desktop0 上使用下面的地址 172.16.3.25/255.255.255.0 
	C 此链路在系统重启之后依然保持正常状态
[root@server0 ~]# nmcli connection add type team con-name team0 ifname team0 autoconnect yes config '{"runner": {"name": "activebackup"}}'
[root@server0 ~]# nmcli connection add type team-slave con-name team0-1 ifname eth1 master team0
[root@server0 ~]# nmcli connection add type team-slave con-name team0-2 ifname eth2 master team0
[root@server0 ~]# nmcli connection modify team0 ipv4.method manual ipv4.addresses '172.16.3.20/24' connection.autoconnect yes
[root@server0 ~]# nmcli connection up team0
[root@server0 ~]# nmcli connection up team0-1
[root@server0 ~]# nmcli connection up team0-2
[root@server0 ~]# teamdctl team0 state

[root@desktop0 ~]# nmcli connection add type team con-name team0 ifname team0 autoconnect yes config '{"runner": {"name": "activebackup"}}'
[root@desktop0 ~]# nmcli connection add type team-slave con-name team0-1 ifname eth1 master team0
[root@desktop0 ~]# nmcli connection add type team-slave con-name team0-2 ifname eth2 master team0
[root@desktop0 ~]# nmcli connection modify team0 ipv4.method manual ipv4.addresses 172.16.3.25/24 connection.autoconnect yes
[root@desktop0 ~]# nmcli connection up team0
[root@desktop0 ~]# nmcli connection up team0-1
[root@desktop0 ~]# nmcli connection up team0-2
[root@desktop0 ~]# teamdctl team0 state

扩展案例23:在server上操作,验证端口转发策略
C 从desktop0上访问server0的5423端口，与访问server0的80端口效果一样


